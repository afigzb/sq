<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Alpine.js 轮播图</title>
    <!-- 引入 Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- 引入 Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div 
      x-data="{
          slides: [
              { type: 'image', url: 'https://images.pexels.com/photos/30154480/pexels-photo-30154480.jpeg?auto=compress&cs=tinysrgb&w=600&lazy=load', link: 'https://example.com/page1' },
              { type: 'video', url: 'https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4', link: 'https://example.com/page2' },
              { type: 'image', url: 'https://images.unsplash.com/photo-1736695796493-699707480bcf?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxmZWF0dXJlZC1waG90b3MtZmVlZHw0NHx8fGVufDB8fHx8fA%3D%3D', link: 'https://example.com/page3' }
          ],
          currentIndex: 0,
          intervalId: null,
          isDragging: false,
          startX: 0,
          dragDistance: 0,
          
          initAutoplay() {
              this.startAutoPlay();
              const handler = () => document.hidden ? this.stopAutoPlay() : this.startAutoPlay();
              document.addEventListener('visibilitychange', handler);
              this.$el._visibilityHandler = handler;
          },
          startAutoPlay() {
              this.stopAutoPlay();
              this.intervalId = setInterval(() => this.nextSlide(), 3000);
          },
          stopAutoPlay() {
              clearInterval(this.intervalId);
          },
          nextSlide() {
              this.currentIndex = (this.currentIndex + 1) % this.slides.length;
          },
          prevSlide() {
              this.currentIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;
          },
          goTo(index) {
              this.currentIndex = index;
          },
          handleDragStart(event) {
              this.isDragging = true;
              this.startX = this.getClientX(event);
              this.stopAutoPlay();
          },
          handleDragMove(event) {
              if (!this.isDragging) return;
              this.dragDistance = this.startX - this.getClientX(event);
          },
          handleDragEnd() {
              if (!this.isDragging) return;
              this.isDragging = false;
              Math.abs(this.dragDistance) > 50 && (this.dragDistance > 0 ? this.nextSlide() : this.prevSlide());
              this.dragDistance = 0;
              this.startAutoPlay();
          },
          getClientX(event) {
              return event.touches ? event.touches[0].clientX : event.clientX;
          }
      }"
      x-init="initAutoplay()"
      x-destroy="stopAutoPlay(); document.removeEventListener('visibilitychange', $el._visibilityHandler)"
      @mouseenter.stop="stopAutoPlay()"
      @mouseleave.debounce.100ms="startAutoPlay()"
      @mousedown="handleDragStart"
      @mousemove.throttle.100ms="handleDragMove"
      @mouseup="handleDragEnd"
      @touchstart.passive="handleDragStart"
      @touchmove.passive.throttle.100ms="handleDragMove"
      @touchend="handleDragEnd"
      class="relative w-full h-64 overflow-hidden"
  >
      <!-- 轮播内容 -->
      <div class="relative w-full h-full">
          <template x-for="(slide, index) in slides" :key="index">
              <div 
                  x-show="currentIndex === index" 
                  x-transition:enter="transition-opacity ease-in-out duration-700"
                  x-transition:enter-start="opacity-0 scale-95"
                  x-transition:enter-end="opacity-100 scale-100"
                  x-transition:leave="transition-opacity ease-in-out duration-500"
                  x-transition:leave-start="opacity-100 scale-100"
                  x-transition:leave-end="opacity-0 scale-95"
                  class="absolute inset-0 flex items-center justify-center w-full h-full"
              >
                  <a 
                      :href="slide.link" 
                      class="w-full h-full cursor-pointer block"
                      @click.prevent="console.log('Navigate to:', slide.link)"
                  >
                      <template x-if="slide.type === 'image'">
                          <img :src="slide.url" alt="Slide" class="w-full h-full object-cover">
                      </template>
                      <template x-if="slide.type === 'video'">
                          <video :src="slide.url" autoplay loop muted playsinline class="w-full h-full object-cover"></video>
                      </template>
                  </a>
              </div>
          </template>
      </div>

      <!-- 导航控制 -->
      <button 
          @click="prevSlide()" 
          class="absolute left-4 top-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100"
          aria-label="Previous slide"
      >←</button>
      
      <button 
          @click="nextSlide()" 
          class="absolute right-4 top-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100"
          aria-label="Next slide"
      >→</button>

      <!-- 指示器 -->
      <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
          <template x-for="(_, index) in slides" :key="index">
              <button 
                  @click="goTo(index)" 
                  class="w-4 h-4 rounded-full transition-colors"
                  :class="currentIndex === index ? 'bg-blue-600' : 'bg-gray-300 hover:bg-gray-400'"
                  :aria-label="`Go to slide ${index + 1}`"
              ></button>
          </template>
      </div>
  </div>
</body>



</html>