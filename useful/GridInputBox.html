<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GridInputBox</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<!-- 无法支持复制黏贴 -->
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div x-data="inputHandler()" class="p-6 bg-white shadow-md rounded-md space-y-4">
        <h1 class="text-xl font-bold text-center">输入框组</h1>
        <div class="grid grid-cols-8 gap-2">
            <template x-for="(field, index) in fields" :key="index">
                <input 
                    type="text" 
                    x-model="fields[index]" 
                    x-on:focus="activateField(index)" 
                    x-on:input="moveToNext(index, $event)" 
                    x-on:keydown.backspace="handleBackspace(index)"
                    x-on:compositionstart="handleCompositionStart" 
                    x-on:paste="handlePaste($event, index)"
                    x-on:compositionend="handleCompositionEnd(index, $event)"
                    class="w-10 h-10 text-center border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-blue-300"
                    maxlength="1" />
            </template>
        </div>
        <button x-on:click="clearFields()" class="w-full py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">清空</button>
        <div>
            <p class="text-center text-gray-600">组合结果: <span x-text="ObtainedData"></span></p>
        </div>
    </div>
</body>
<script>
    function inputHandler() {
        return {
            fields: Array(8).fill(''),
            currentField: 0,
            isComposing: false,
            ObtainedData: '',

            // 激活输入框
            activateField(index) {
                this.currentField = index;
            },

            // 焦点切换工具函数
            focusField(index) {
                setTimeout(() => {
                    const inputFields = document.querySelectorAll('input');
                    if (inputFields[index]) {
                        inputFields[index].focus();
                    }
                }, 0);
            },

            // 移动到下一个输入框
            moveToNext(index, event) {
                if (this.isComposing) return;
                if (this.fields[index].length === 1 && index < this.fields.length - 1) {
                    this.currentField = index + 1;
                    this.focusField(this.currentField);
                }

                // 全部输入完成后处理逻辑
                if (this.fields.every(field => field.length === 1)) {
                    this.validateAndCombine();
                }
            },
            
            // 校验并合并数据
            validateAndCombine() {
                const plateNumber = this.fields.join('');
                if (/^\d/.test(plateNumber)) {
                    alert('不能以数字开头');
                } else {
                    this.ObtainedData = plateNumber;
                    this.currentField = null;
                }
            },

            // 处理退格键逻辑
            handleBackspace(index) {
                if (index > 0 && this.fields[index] === '') {
                    this.fields[index - 1] = ''; 
                    this.currentField = index - 1; 
                    this.focusField(this.currentField);
                } else {
                    this.fields[index] = '';
                }
            },

            // 清空输入框
            clearFields() {
                this.fields.fill('');
                this.currentField = 0;
                this.focusField(this.currentField);
            },

            // 填充输入框
            fillFieldsWithString(inputString) {
                const characters = inputString.split('');
                this.fields = characters.slice(0, 8).concat(Array(8 - characters.length).fill(''));
            },
            // 组合输入事件开始 
            handleCompositionStart() {
                this.isComposing = true;
            },
            // 组合输入事件结束
            handleCompositionEnd(index, event) {
                this.isComposing = false;
                if (this.fields[index].length === 1) {
                    // 检查是否所有字段填满
                    if (this.fields.every(field => field.length === 1)) {
                        this.validateAndCombine();
                    } else if (index < this.fields.length - 1) {
                        this.moveToNext(index, event);
                    }
                }
            },
            handlePaste(event, index) {
                event.preventDefault();
                const pasteData = event.clipboardData.getData("text").replace(/\s+/g, ''); // 去除空格
                if (!pasteData) return;

                const characters = pasteData.split('');

                for (let i = 0; i < characters.length && i < this.fields.length; i++) {
                    this.fields[i] = characters[i];
                }

                const lastFilledIndex = Math.min(characters.length, this.fields.length) - 1;
                this.focusField(lastFilledIndex);

                this.validateAndCombine();
            }

        };
    }
</script>

</html>