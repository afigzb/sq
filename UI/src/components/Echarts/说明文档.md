# EChartFactory2 图表工厂 说明文档

## 📊 项目简介

EChartFactory2 是一个基于 ECharts 的简化版图表工厂，旨在提供更简单、更灵活的图表创建和管理方案。相比 v1 版本，将所有逻辑内聚在一个文件中，减少文件依赖，提高易用性。

### 🎯 设计理念

- **简化**：将复杂的图表配置简化为直观的API调用
- **灵活**：支持多种图表类型、主题切换、自定义配置
- **易扩展**：模块化设计，新增图表类型和主题都很方便
- **易维护**：代码结构清晰，注释详细

## ✨ 功能特性

### 📈 支持的图表类型

| 图表类型 | 说明 | 特色功能 |
|---------|------|---------|
| `bar` | 柱状图 | 支持堆叠、横向显示 |
| `line` | 折线图 | 支持面积填充、平滑曲线 |
| `pie` | 饼图 | 支持玫瑰图、环形图 |
| `radar` | 雷达图 | 多维度数据对比 |
| `scatter` | 散点图 | 两变量关系展示 |
| `polarBar` | 极坐标柱状图 | 环形柱状图效果 |
| `polarLine` | 极坐标折线图 | 周期性数据展示 |

### 🎨 内置主题

- **default** - 默认主题，经典蓝色系
- **futuristic** - 科技主题，深色背景+炫彩色彩
- **minimal** - 极简主题，黑白灰配色
- **cleanDark** - 干净深色主题，适合暗色界面

### 🔧 核心功能

- ✅ 自动响应式适配
- ✅ 主题动态切换
- ✅ 图表类型动态切换
- ✅ 预设配置系统
- ✅ 批量图表创建
- ✅ 自定义样式支持
- ✅ 完整的生命周期管理

## 🚀 快速开始

### 基础用法

```javascript
import { createChart } from './EchartFactory2.js';

// 创建容器
const container = document.getElementById('chart-container');

// 创建柱状图
const chart = createChart(container, 'bar', 'default');

// 准备数据
const data = {
  xAxis: ['周一', '周二', '周三', '周四', '周五'],
  series: {
    name: '销量',
    data: [120, 200, 150, 80, 70],
    color: '#5470c6'
  }
};

// 更新图表
chart.update(data);
```

### 高级用法

```javascript
import { EChartFactory2 } from './EchartFactory2.js';

// 创建工厂实例
const factory = new EChartFactory2(container, 'line', 'futuristic');

// 初始化并配置
factory.init()
  .setPreset('dashboard')  // 设置预设
  .update(data, {
    areaStyle: true,        // 面积填充
    stack: 'total'          // 堆叠显示
  });

// 动态切换主题
factory.switchTheme('minimal');

// 动态切换图表类型
factory.switchType('bar');
```

## 📚 API 文档

### EChartFactory2 类

#### 构造函数

```javascript
new EChartFactory2(container, chartType, theme)
```

| 参数 | 类型 | 说明 | 默认值 |
|------|------|------|--------|
| container | HTMLElement | 图表容器DOM元素 | - |
| chartType | string | 图表类型 | 'bar' |
| theme | string/Object | 主题名称或主题对象 | 'default' |

#### 主要方法

##### `init()`
初始化图表实例
- **返回**: `EChartFactory2` - 支持链式调用
- **说明**: 创建ECharts实例并设置自适应监听

##### `update(data, config)`
更新图表数据和配置
- **参数**:
  - `data` (Object): 图表数据对象
  - `config` (Object): 自定义配置对象
- **返回**: `EChartFactory2` - 支持链式调用

##### `switchTheme(themeName)`
切换图表主题
- **参数**: `themeName` (string/Object) - 主题名称或主题对象
- **返回**: `EChartFactory2` - 支持链式调用

##### `switchType(chartType)`
切换图表类型
- **参数**: `chartType` (string) - 新的图表类型
- **返回**: `EChartFactory2` - 支持链式调用

##### `setPreset(presetName)`
设置预设配置
- **参数**: `presetName` (string) - 预设名称
- **返回**: `EChartFactory2` - 支持链式调用

##### `getInstance()`
获取ECharts原生实例
- **返回**: `Object` - ECharts实例对象

##### `dispose()`
销毁图表实例
- **返回**: `EChartFactory2` - 支持链式调用

### 工厂函数

#### `createChart(container, chartType, theme)`
创建图表的快捷函数
- **返回**: `EChartFactory2` - 已初始化的图表实例

#### `updateChart(container, chartType, data, config, theme)`
快速更新图表（会复用已存在的实例）
- **返回**: `EChartFactory2` - 图表实例

#### `createCharts(configs)`
批量创建多个图表
- **参数**: `configs` (Array) - 图表配置数组
- **返回**: `Array` - 图表实例数组

## 💡 使用示例

### 1. 基础柱状图

```javascript
const data = {
  xAxis: ['产品A', '产品B', '产品C', '产品D'],
  series: {
    name: '销量',
    data: [320, 302, 301, 334],
    color: '#5470c6'
  }
};

createChart(container, 'bar', 'default').update(data);
```

### 2. 堆叠柱状图

```javascript
const data = {
  xAxis: ['周一', '周二', '周三', '周四', '周五'],
  series: [
    { name: '线上', data: [120, 132, 101, 134, 90], color: '#5470c6' },
    { name: '线下', data: [220, 182, 191, 234, 290], color: '#91cc75' }
  ]
};

createChart(container, 'bar', 'default').update(data, { stack: 'total' });
```

### 3. 面积折线图

```javascript
const data = {
  xAxis: ['1月', '2月', '3月', '4月', '5月'],
  series: {
    name: '访问量',
    data: [820, 932, 901, 934, 1290],
    color: '#5470c6'
  }
};

createChart(container, 'line', 'futuristic').update(data, { areaStyle: true });
```

### 4. 饼图

```javascript
const data = {
  series: [{
    data: [
      { value: 1048, name: '搜索引擎' },
      { value: 735, name: '直接访问' },
      { value: 580, name: '邮件营销' },
      { value: 484, name: '联盟广告' },
      { value: 300, name: '视频广告' }
    ]
  }]
};

createChart(container, 'pie', 'minimal').update(data);
```

### 5. 雷达图

```javascript
const data = {
  indicator: [
    { name: '销售', max: 6500 },
    { name: '管理', max: 16000 },
    { name: '信息技术', max: 30000 },
    { name: '客服', max: 38000 },
    { name: '研发', max: 52000 },
    { name: '市场', max: 25000 }
  ],
  series: [{
    data: [{
      value: [4300, 10000, 28000, 35000, 50000, 19000],
      name: '预算分配'
    }]
  }]
};

createChart(container, 'radar', 'default').update(data);
```

### 6. 极坐标图

```javascript
const data = {
  angleData: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
  series: [{
    name: '访问量',
    data: [1200, 2300, 1500, 2800, 1800, 2200, 1600],
    color: '#5470c6'
  }]
};

createChart(container, 'polarBar', 'futuristic').update(data);
```

### 7. 多系列组合

```javascript
// 创建多个图表
const configs = [
  {
    container: document.getElementById('chart1'),
    chartType: 'bar',
    theme: 'default',
    data: barData,
    customConfig: { stack: 'total' }
  },
  {
    container: document.getElementById('chart2'),
    chartType: 'line',
    theme: 'futuristic',
    data: lineData,
    customConfig: { areaStyle: true }
  }
];

createCharts(configs);
```

## ⚙️ 配置说明

### 数据格式

#### 直角坐标系图表 (bar, line, scatter)

```javascript
{
  xAxis: ['分类1', '分类2', '分类3'],  // X轴数据
  series: {
    name: '系列名称',
    data: [100, 200, 150],
    color: '#5470c6'  // 可选，自定义颜色
  }
  // 或多系列
  series: [
    { name: '系列1', data: [100, 200, 150] },
    { name: '系列2', data: [200, 300, 250] }
  ]
}
```

#### 饼图 (pie)

```javascript
{
  series: [{
    data: [
      { value: 335, name: '直接访问' },
      { value: 310, name: '邮件营销' },
      { value: 234, name: '联盟广告' }
    ]
  }]
}
```

#### 雷达图 (radar)

```javascript
{
  indicator: [  // 雷达图指示器
    { name: '指标1', max: 100 },
    { name: '指标2', max: 100 }
  ],
  series: [{
    data: [{
      value: [80, 90],
      name: '数据系列'
    }]
  }]
}
```

#### 极坐标图 (polarBar, polarLine)

```javascript
{
  angleData: ['角度1', '角度2', '角度3'],  // 角度轴数据
  series: [{
    name: '系列名称',
    data: [100, 200, 150]
  }]
}
```

### 配置选项

| 配置项 | 类型 | 说明 | 适用图表 |
|--------|------|------|----------|
| `stack` | string | 堆叠分组标识 | bar, line |
| `inverse` | boolean | 翻转坐标轴（横向显示） | bar |
| `areaStyle` | boolean | 启用面积填充 | line |
| `roseType` | string | 玫瑰图类型 | pie |
| `toolboxType` | string | 工具箱类型 | 所有 |

## 🔥 高级功能

### 1. 主题自定义

```javascript
// 创建自定义主题
const customTheme = {
  colors: {
    series: ['#FF6B6B', '#4ECDC4', '#45B7D1'],
    background: {
      chart: '#1a1a1a',
      tooltip: '#333333'
    },
    text: {
      primary: '#ffffff',
      secondary: '#cccccc'
    }
  }
};

// 使用自定义主题
const chart = createChart(container, 'bar', customTheme);
```

### 2. 预设配置

```javascript
// 使用仪表盘预设
factory.setPreset('dashboard');

// 使用分析预设
factory.setPreset('analysis');
```

### 3. 事件监听

```javascript
const chart = createChart(container, 'bar', 'default');
const instance = chart.getInstance();

// 监听点击事件
instance.on('click', (params) => {
  console.log('点击了:', params.name, params.value);
});

// 监听图例切换
instance.on('legendselectchanged', (params) => {
  console.log('图例状态:', params.selected);
});
```

### 4. 动画配置

```javascript
const chart = createChart(container, 'bar', 'default');

// 自定义动画
chart.update(data, {
  animation: true,
  animationDuration: 2000,
  animationEasing: 'elasticOut'
});
```

### 5. 响应式设计

```javascript
// 图表会自动适配容器大小变化
// 无需手动调用 resize()
const chart = createChart(container, 'line', 'default');

// 容器大小改变时，图表会自动调整
```

### 6. 独立样式模式

```javascript
// 完全脱离主题系统的独立样式
const independentOptions = factory.generateIndependentOptions(data, {
  color: ['#FF6B6B', '#4ECDC4'],
  backgroundColor: '#000000',
  grid: { left: '10%', right: '10%' }
});

factory.setCustomOptions(independentOptions);
```

## 🛠️ 开发指南

### 扩展新图表类型

```javascript
// 在 CHART_TYPE_CONFIGS 中添加新类型
newChartType: {
  coordinateSystem: 'cartesian',  // 坐标系类型
  series: (data, theme, config) => ({
    type: 'newType',
    data: data.data,
    // 其他配置...
  }),
  defaultConfig: {}
}
```

### 添加新主题

```javascript
// 在 themes.js 中添加新主题
newTheme: {
  colors: {
    series: ['#color1', '#color2'],
    background: { chart: '#bg', tooltip: '#tooltip' },
    text: { primary: '#text1', secondary: '#text2' },
    axisLine: '#axis'
  },
  grid: { /* 网格配置 */ },
  components: { /* 组件配置 */ }
}
```

## ❓ 常见问题

### Q: 如何处理大数据量？

A: 可以使用 ECharts 的数据采样和虚拟滚动功能：

```javascript
chart.update(data, {
  dataZoom: [{
    type: 'inside',
    start: 0,
    end: 100
  }],
  sampling: 'lttb'  // 采样算法
});
```

### Q: 如何自定义提示框？

A: 通过配置 tooltip 格式化函数：

```javascript
chart.update(data, {
  tooltip: {
    formatter: function(params) {
      return `${params.name}: ${params.value}`;
    }
  }
});
```

### Q: 图表不显示怎么办？

A: 检查以下几点：
1. 容器是否有明确的宽高
2. 数据格式是否正确
3. 容器是否已添加到DOM中
4. 是否正确调用了 update() 方法

### Q: 如何实现图表联动？

A: 通过事件监听实现：

```javascript
const chart1 = createChart(container1, 'bar', 'default');
const chart2 = createChart(container2, 'line', 'default');

chart1.getInstance().on('click', (params) => {
  // 根据 chart1 的点击更新 chart2
  chart2.update(getRelatedData(params.dataIndex));
});
```

